<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvt="clr-namespace:STranslate.Converters"
    xmlns:control="clr-namespace:STranslate.Controls"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
    xmlns:plugin="clr-namespace:STranslate.Plugin;assembly=STranslate.Plugin"
    xmlns:s="https://github.com/zggsong/2022/xaml"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    xmlns:xf="clr-namespace:XamlFlair;assembly=XamlFlair.WPF">
    <Style
        x:Key="QuickSettingsButtonStyle"
        BasedOn="{StaticResource {x:Type Button}}"
        TargetType="Button">
        <Setter Property="Opacity" Value="0" />
        <Setter Property="IsHitTestVisible" Value="False" />
        <Style.Triggers>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=IsMouseOver}" Value="True">
                <DataTrigger.EnterActions>
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                Storyboard.TargetProperty="Opacity"
                                To="1"
                                Duration="0:0:0.1" />
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.EnterActions>
                <DataTrigger.ExitActions>
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                Storyboard.TargetProperty="Opacity"
                                To="0"
                                Duration="0:0:0.08" />
                        </Storyboard>
                    </BeginStoryboard>
                </DataTrigger.ExitActions>
                <Setter Property="IsHitTestVisible" Value="True" />
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <!--#region Prompt ComboBox Selector-->

    <DataTemplate x:Key="ComboBoxTemplate" DataType="plugin:Service">
        <ComboBox
            MinWidth="120"
            VerticalAlignment="Center"
            DisplayMemberPath="Name"
            ItemsSource="{Binding Plugin.Prompts}"
            SelectedItem="{Binding Plugin.SelectedPrompt, Mode=TwoWay}"
            Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowPrompt, Converter={cnvt:BoolToVisibilityConverter}}" />
    </DataTemplate>

    <DataTemplate x:Key="EmptyTemplate" />

    <control:OutputComboBoxSelector
        x:Key="OutputComboBoxSelector"
        ComboBoxTemplate="{StaticResource ComboBoxTemplate}"
        EmptyTemplate="{StaticResource EmptyTemplate}" />

    <!--#endregion-->

    <!--#region Plugin Selector-->

    <DataTemplate x:Key="DictionaryPluginTemplate" DataType="plugin:Service">
        <DataTemplate.Resources>
            <Style BasedOn="{StaticResource {x:Type ui:FontIcon}}" TargetType="ui:FontIcon">
                <Setter Property="FontSize" Value="{DynamicResource STControlFontSize16}" />
            </Style>
        </DataTemplate.Resources>
        <Expander
            Margin="0,0,0,5"
            Padding="0"
            HorizontalAlignment="Stretch"
            control:ExpanderAttach.HasResult="{Binding Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultSuccessErrorBoolConverter}}"
            Style="{StaticResource AnimatedExpanderCardStyle}">
            <Expander.Visibility>
                <MultiBinding Converter="{cnvt:ServiceVisibilityConverter}">
                    <Binding Path="IsEnabled" />
                    <Binding Path="Options.ExecMode" />
                    <Binding Path="Options.TemporaryDisplay" />
                </MultiBinding>
            </Expander.Visibility>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Expanded">
                    <i:Interaction.Behaviors>
                        <i:ConditionBehavior>
                            <i:ConditionalExpression>
                                <i:ComparisonCondition
                                    LeftOperand="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=(control:ExpanderAttach.IsAutoExpanded)}"
                                    Operator="Equal"
                                    RightOperand="False" />
                            </i:ConditionalExpression>
                        </i:ConditionBehavior>
                    </i:Interaction.Behaviors>
                    <i:InvokeCommandAction Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=RetryCommand}" CommandParameter="{Binding}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <Expander.Header>
                <DockPanel>
                    <ikw:SimpleStackPanel
                        Background="Transparent"
                        DockPanel.Dock="Left"
                        Orientation="Horizontal"
                        Spacing="10">
                        <Image
                            Width="{DynamicResource STControlFontSize18}"
                            Height="{DynamicResource STControlFontSize18}"
                            Source="{Binding MetaData.IconPath}" />
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="{DynamicResource STControlFontSize12}"
                            Text="{Binding DisplayName}" />
                        <!--  // https://learn.microsoft.com/zh-cn/windows/apps/design/style/segoe-fluent-icons-font //  -->
                        <TextBlock
                            VerticalAlignment="Center"
                            FontFamily="{DynamicResource {x:Static ui:ThemeKeys.FluentSystemIconsKey}}"
                            Foreground="{DynamicResource {x:Static ui:ThemeKeys.SystemControlErrorTextForegroundBrushKey}}"
                            Text="&#xF618;"
                            Visibility="{Binding Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultTypeVisibilityConverter}, ConverterParameter=NoResult}" />
                        <ui:ProgressRing
                            Width="{DynamicResource STControlFontSize16}"
                            Height="{DynamicResource STControlFontSize16}"
                            IsActive="{Binding Plugin.DictionaryResult.IsProcessing}"
                            Visibility="{Binding Plugin.DictionaryResult.IsProcessing, Converter={cnvt:BoolToVisibilityConverter}}" />
                        <ikw:SimpleStackPanel
                            Orientation="Horizontal"
                            Spacing="5"
                            Visibility="{Binding Plugin.DictionaryResult.Duration, Converter={cnvt:TimeSpanToVisibilityConverter}}">
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Timer_24_Regular}" Opacity="0.6" />
                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="{DynamicResource STControlFontSize10}"
                                Opacity="0.7"
                                Text="{Binding Plugin.DictionaryResult.Duration, StringFormat='\{0:ss\\.ff}'}" />
                        </ikw:SimpleStackPanel>
                    </ikw:SimpleStackPanel>
                    <ikw:SimpleStackPanel
                        Background="Transparent"
                        DockPanel.Dock="Right"
                        FlowDirection="RightToLeft"
                        Orientation="Horizontal"
                        Spacing="10">
                        <control:IconButton
                            Padding="6"
                            Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=RetryCommand}"
                            CommandParameter="{Binding}"
                            Icon="{x:Static ui:FluentSystemIcons.ArrowSync_20_Regular}"
                            IconSize="{DynamicResource STControlFontSize12}"
                            ToolTip="{DynamicResource Retry}"
                            Visibility="{Binding Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultTypeVisibilityConverter}, ConverterParameter=Error}" />

                        <Button
                            Padding="5,3"
                            FlowDirection="LeftToRight"
                            Style="{StaticResource QuickSettingsButtonStyle}">
                            <ui:FontIcon FontSize="{DynamicResource STControlFontSize18}" Icon="{x:Static ui:FluentSystemIcons.SettingsCogMultiple_20_Regular}" />
                            <Button.Resources>
                                <s:BindingProxy x:Key="SvcProxy" Data="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=DataContext}" />
                                <s:BindingProxy x:Key="MainVmProxy" Data="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=DataContext}" />
                            </Button.Resources>
                            <ui:FlyoutService.Flyout>
                                <ui:MenuFlyout Placement="BottomEdgeAlignedRight">
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.SingleTranslateCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource ExecuteTranslation}"
                                        IsEnabled="{Binding Source={StaticResource SvcProxy}, Path=Data.Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultNoResultInverseBoolConverter}}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Translate_24_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem Header="{DynamicResource TransExecMode}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.GlanceHorizontalSparkles_20_Regular}" />
                                        </MenuItem.Icon>
                                        <MenuItem
                                            Header="{DynamicResource TransExecAutomatic}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Automatic}" />
                                        <MenuItem
                                            Header="{DynamicResource TransExecManual}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Manual}" />
                                        <MenuItem
                                            Header="{DynamicResource TransExecPinned}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Pinned}" />
                                    </MenuItem>
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.NavigateCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource ConfigureService}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Settings_24_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.CloseServiceCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource CloseService}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.PictureInPictureExit_20_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ui:MenuFlyout>
                            </ui:FlyoutService.Flyout>
                        </Button>
                    </ikw:SimpleStackPanel>
                </DockPanel>
            </Expander.Header>
            <Expander.Content>
                <Border
                    x:Name="ContentBorder"
                    Background="{DynamicResource {x:Static ui:ThemeKeys.CardBackgroundFillColorDefaultBrushKey}}"
                    ClipToBounds="True"
                    CornerRadius="4"
                    RenderTransformOrigin="0.5,0">
                    <Border.RenderTransform>
                        <ScaleTransform ScaleY="1" />
                    </Border.RenderTransform>
                    <Grid>
                        <TextBox
                            Background="Transparent"
                            BorderBrush="{x:Null}"
                            BorderThickness="0"
                            Foreground="{DynamicResource {x:Static ui:ThemeKeys.SystemControlErrorTextForegroundBrushKey}}"
                            IsReadOnly="True"
                            Text="{Binding Plugin.DictionaryResult.Text}"
                            TextWrapping="Wrap"
                            Visibility="{Binding Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultTypeVisibilityConverter}, ConverterParameter=Error}" />
                        <StackPanel Margin="8,8,8,4" Visibility="{Binding Plugin.DictionaryResult.ResultType, Converter={cnvt:DictionaryResultTypeVisibilityConverter}, ConverterParameter=Success}">
                            <!--  单词显示  -->
                            <TextBox
                                Margin="0,0,0,12"
                                FontSize="{DynamicResource STControlFontSize16}"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource {x:Static ui:ThemeKeys.TextControlForegroundKey}}"
                                IsReadOnly="True"
                                Style="{DynamicResource TextBlockSimilarStyle}"
                                Text="{Binding Plugin.DictionaryResult.Text}"
                                TextWrapping="Wrap" />

                            <!--  音标显示  -->
                            <ItemsControl
                                Margin="0,0,0,4"
                                ItemsSource="{Binding Plugin.DictionaryResult.Symbols}"
                                Visibility="{Binding Plugin.DictionaryResult.Symbols.Count, Converter={cnvt:CountToVisibilityConverter}}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ikw:SimpleStackPanel Orientation="Horizontal" Spacing="15" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <ikw:SimpleStackPanel Orientation="Horizontal" Spacing="5">
                                            <!--  音标标签 (uk/us/zh)  -->
                                            <Border
                                                Margin="0,3"
                                                Padding="4,0"
                                                Background="{DynamicResource {x:Static ui:ThemeKeys.AccentAAFillColorDefaultBrushKey}}"
                                                CornerRadius="2">
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="{DynamicResource STControlFontSize10}"
                                                    Foreground="{DynamicResource {x:Static ui:ThemeKeys.TextOnAccentFillColorPrimaryBrushKey}}"
                                                    Text="{Binding Label}" />
                                            </Border>
                                            <!--  音标文本  -->
                                            <TextBlock
                                                VerticalAlignment="Center"
                                                FontFamily="Consolas, 'Courier New'"
                                                FontSize="{DynamicResource STControlFontSize12}"
                                                Text="{Binding Phonetic, StringFormat='/\{0\}/'}" />
                                            <!--  音频播放按钮  -->
                                            <Button
                                                Padding="4"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=PlayAudioUrlCommand}"
                                                CommandParameter="{Binding AudioUrl}"
                                                ToolTip="{DynamicResource PlayPronunciation}"
                                                Visibility="{Binding AudioUrl, Converter={cnvt:EqualToVisibilityInverseConverter}}">
                                                <ui:FontIcon FontSize="{DynamicResource STControlFontSize12}" Icon="{x:Static ui:FluentSystemIcons.Speaker1_24_Regular}" />
                                            </Button>
                                        </ikw:SimpleStackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!--  词性和释义  -->
                            <ItemsControl
                                Margin="0,0,0,8"
                                ItemsSource="{Binding Plugin.DictionaryResult.DictMeans}"
                                Visibility="{Binding Plugin.DictionaryResult.DictMeans.Count, Converter={cnvt:CountToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <!--  词性  -->
                                            <TextBlock
                                                Margin="0,3,0,0"
                                                FontSize="{DynamicResource STControlFontSize12}"
                                                FontWeight="Medium"
                                                Foreground="{DynamicResource {x:Static ui:ThemeKeys.AccentTextFillColorPrimaryBrushKey}}"
                                                Text="{Binding PartOfSpeech}"
                                                Visibility="{Binding PartOfSpeech, Converter={cnvt:EqualToVisibilityInverseConverter}}" />
                                            <!--  释义  -->
                                            <TextBox
                                                Grid.Column="1"
                                                Margin="4,0,0,0"
                                                IsReadOnly="True"
                                                Style="{DynamicResource TextBlockSimilarStyle}"
                                                Text="{Binding Means, Converter={cnvt:CollectionToStringConverter}, ConverterParameter=；}"
                                                TextWrapping="Wrap" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!--#region // 词汇变形 //-->

                            <!--  复数形式  -->
                            <control:WordExchange
                                Title="{DynamicResource Plural}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.Plurals}" />

                            <!--  过去式  -->
                            <control:WordExchange
                                Title="{DynamicResource PastTense}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.PastTense}" />

                            <!--  过去分词  -->
                            <control:WordExchange
                                Title="{DynamicResource PastParticiple}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.PastParticiple}" />

                            <!--  现在分词  -->
                            <control:WordExchange
                                Title="{DynamicResource PresentParticiple}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.PresentParticiple}" />

                            <!--  第三人称单数  -->
                            <control:WordExchange
                                Title="{DynamicResource ThirdPersonSingular}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.ThirdPersonSingular}" />

                            <!--  比较级  -->
                            <control:WordExchange
                                Title="{DynamicResource Comparative}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.Comparative}" />

                            <!--  最高级  -->
                            <control:WordExchange
                                Title="{DynamicResource Superlative}"
                                ExecuteCommand="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ExplainCommand}"
                                ItemsSource="{Binding Plugin.DictionaryResult.Superlative}" />

                            <!--#endregion-->

                            <!--  例句显示  -->
                            <ItemsControl
                                Margin="0,8,0,0"
                                ItemsSource="{Binding Plugin.DictionaryResult.Sentences}"
                                Visibility="{Binding Plugin.DictionaryResult.Sentences.Count, Converter={cnvt:CountToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,2"
                                            Padding="8,6"
                                            Background="{DynamicResource {x:Static ui:ThemeKeys.CardBackgroundFillColorSecondaryBrushKey}}"
                                            CornerRadius="4">
                                            <TextBlock
                                                FontStyle="Italic"
                                                Text="{Binding}"
                                                TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                </Border>
            </Expander.Content>
        </Expander>
    </DataTemplate>

    <DataTemplate x:Key="TransaltePluginTemplate" DataType="plugin:Service">
        <DataTemplate.Resources>
            <Style BasedOn="{StaticResource {x:Type ui:FontIcon}}" TargetType="ui:FontIcon">
                <Setter Property="FontSize" Value="{DynamicResource STControlFontSize16}" />
            </Style>
        </DataTemplate.Resources>
        <Expander
            Margin="0,0,0,5"
            Padding="0"
            HorizontalAlignment="Stretch"
            control:ExpanderAttach.HasResult="{Binding Plugin.TransResult.Text, Converter={cnvt:StringToBoolInverseConverter}}"
            Style="{StaticResource AnimatedExpanderCardStyle}">
            <Expander.Visibility>
                <MultiBinding Converter="{cnvt:ServiceVisibilityConverter}">
                    <Binding Path="IsEnabled" />
                    <Binding Path="Options.ExecMode" />
                    <Binding Path="Options.TemporaryDisplay" />
                </MultiBinding>
            </Expander.Visibility>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Expanded">
                    <i:Interaction.Behaviors>
                        <i:ConditionBehavior>
                            <i:ConditionalExpression>
                                <i:ComparisonCondition
                                    LeftOperand="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=(control:ExpanderAttach.IsAutoExpanded)}"
                                    Operator="Equal"
                                    RightOperand="False" />
                            </i:ConditionalExpression>
                        </i:ConditionBehavior>
                    </i:Interaction.Behaviors>
                    <i:InvokeCommandAction Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=RetryCommand}" CommandParameter="{Binding}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <Expander.Header>
                <DockPanel>
                    <ikw:SimpleStackPanel
                        Background="Transparent"
                        DockPanel.Dock="Left"
                        Orientation="Horizontal"
                        Spacing="10">
                        <Image
                            Width="{DynamicResource STControlFontSize18}"
                            Height="{DynamicResource STControlFontSize18}"
                            Source="{Binding MetaData.IconPath}" />
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="{DynamicResource STControlFontSize12}"
                            Text="{Binding DisplayName}" />
                        <!--  条件显示的 ComboBox - 只有 LLM 插件才显示  -->
                        <ContentPresenter Content="{Binding}" ContentTemplateSelector="{StaticResource OutputComboBoxSelector}" />
                        <ui:ProgressRing>
                            <ui:ProgressRing.Style>
                                <Style BasedOn="{StaticResource {x:Type ui:ProgressRing}}" TargetType="ui:ProgressRing">
                                    <Style.Setters>
                                        <Setter Property="Width" Value="{DynamicResource STControlFontSize16}" />
                                        <Setter Property="Height" Value="{DynamicResource STControlFontSize16}" />
                                        <Setter Property="IsActive" Value="False" />
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </Style.Setters>
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding Plugin.TransResult.IsProcessing}" Value="True" />
                                            </MultiDataTrigger.Conditions>
                                            <MultiDataTrigger.Setters>
                                                <Setter Property="IsActive" Value="True" />
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger.Setters>
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding Plugin.TransBackResult.IsProcessing}" Value="True" />
                                            </MultiDataTrigger.Conditions>
                                            <MultiDataTrigger.Setters>
                                                <Setter Property="IsActive" Value="True" />
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger.Setters>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ui:ProgressRing.Style>
                        </ui:ProgressRing>
                        <StackPanel Orientation="Horizontal" Visibility="{Binding Plugin.TransResult.Duration, Converter={cnvt:TimeSpanToVisibilityConverter}}">
                            <StackPanel.Resources>
                                <Style BasedOn="{StaticResource {x:Type TextBlock}}" TargetType="TextBlock">
                                    <Setter Property="VerticalAlignment" Value="Center" />
                                    <Setter Property="FontSize" Value="{DynamicResource STControlFontSize10}" />
                                    <Setter Property="Opacity" Value="0.7" />
                                    <Setter Property="Margin" Value="5,0,0,0" />
                                </Style>
                            </StackPanel.Resources>
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Timer_24_Regular}" Opacity="0.6" />
                            <TextBlock Text="{Binding Plugin.TransResult.Duration, StringFormat='\{0:ss\\.ff}'}" />
                            <TextBlock Text="/" Visibility="{Binding Plugin.TransBackResult.Duration, Converter={cnvt:TimeSpanToVisibilityConverter}}" />
                            <TextBlock Text="{Binding Plugin.TransBackResult.Duration, StringFormat='\{0:ss\\.ff}'}" Visibility="{Binding Plugin.TransBackResult.Duration, Converter={cnvt:TimeSpanToVisibilityConverter}}" />
                        </StackPanel>
                    </ikw:SimpleStackPanel>
                    <ikw:SimpleStackPanel
                        Background="Transparent"
                        DockPanel.Dock="Right"
                        FlowDirection="RightToLeft"
                        Orientation="Horizontal"
                        Spacing="10">
                        <control:IconButton
                            Padding="6"
                            Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=RetryCommand}"
                            CommandParameter="{Binding}"
                            Icon="{x:Static ui:FluentSystemIcons.ArrowSync_20_Regular}"
                            IconSize="{DynamicResource STControlFontSize12}"
                            ToolTip="{DynamicResource Retry}"
                            Visibility="{Binding Plugin.TransResult.IsSuccess, Converter={cnvt:BoolToVisibilityInverseConverter}}" />

                        <Button
                            Padding="5,3"
                            FlowDirection="LeftToRight"
                            Style="{StaticResource QuickSettingsButtonStyle}">
                            <ui:FontIcon FontSize="{DynamicResource STControlFontSize18}" Icon="{x:Static ui:FluentSystemIcons.SettingsCogMultiple_20_Regular}" />
                            <Button.Resources>
                                <s:BindingProxy x:Key="SvcProxy" Data="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=DataContext}" />
                                <s:BindingProxy x:Key="MainVmProxy" Data="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=DataContext}" />
                            </Button.Resources>
                            <ui:FlyoutService.Flyout>
                                <ui:MenuFlyout Placement="BottomEdgeAlignedRight">
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.SingleTranslateCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource ExecuteTranslation}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Translate_20_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem Header="{DynamicResource TransExecMode}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.GlanceHorizontalSparkles_20_Regular}" />
                                        </MenuItem.Icon>
                                        <MenuItem
                                            Header="{DynamicResource TransExecAutomatic}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Automatic}" />
                                        <MenuItem
                                            Header="{DynamicResource TransExecManual}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Manual}" />
                                        <MenuItem
                                            Header="{DynamicResource TransExecPinned}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.ExecMode, Converter={cnvt:ExecutionModeBoolConverter}, ConverterParameter=Pinned}" />
                                    </MenuItem>
                                    <MenuItem Header="{DynamicResource AutoBackTranslation}">
                                        <MenuItem.Style>
                                            <Style BasedOn="{StaticResource {x:Type MenuItem}}" TargetType="MenuItem">
                                                <Setter Property="Icon">
                                                    <Setter.Value>
                                                        <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Flash_20_Regular}" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.AutoBackTranslation}" Value="True">
                                                        <Setter Property="Icon">
                                                            <Setter.Value>
                                                                <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.FlashAuto_20_Regular}" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </MenuItem.Style>
                                        <MenuItem
                                            Header="{DynamicResource On}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.AutoBackTranslation}" />
                                        <MenuItem
                                            Header="{DynamicResource Off}"
                                            IsCheckable="True"
                                            IsChecked="{Binding Source={StaticResource SvcProxy}, Path=Data.Options.AutoBackTranslation, Converter={cnvt:BoolInverseConverter}}" />
                                    </MenuItem>
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.NavigateCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource ConfigureService}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Settings_20_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                    <Separator />
                                    <MenuItem
                                        Command="{Binding Source={StaticResource MainVmProxy}, Path=Data.CloseServiceCommand}"
                                        CommandParameter="{Binding Source={StaticResource SvcProxy}, Path=Data}"
                                        Header="{DynamicResource CloseService}">
                                        <MenuItem.Icon>
                                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.PictureInPictureExit_20_Regular}" />
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ui:MenuFlyout>
                            </ui:FlyoutService.Flyout>
                        </Button>
                    </ikw:SimpleStackPanel>
                </DockPanel>
            </Expander.Header>
            <Expander.Content>
                <Border
                    x:Name="ContentBorder"
                    Background="{DynamicResource {x:Static ui:ThemeKeys.CardBackgroundFillColorDefaultBrushKey}}"
                    ClipToBounds="True"
                    CornerRadius="4"
                    RenderTransformOrigin="0.5,0">
                    <Border.RenderTransform>
                        <ScaleTransform ScaleY="1" />
                    </Border.RenderTransform>
                    <ikw:SimpleStackPanel Spacing="3">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBox
                                Background="Transparent"
                                BorderBrush="{x:Null}"
                                BorderThickness="0"
                                IsReadOnly="True"
                                SnapsToDevicePixels="True"
                                Text="{Binding Plugin.TransResult.Text}"
                                TextWrapping="Wrap">
                                <TextBox.Style>
                                    <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                                        <Setter Property="Foreground" Value="{DynamicResource TextControlForeground}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Plugin.TransResult.IsSuccess}" Value="False">
                                                <Setter Property="Foreground" Value="{DynamicResource SystemControlErrorTextForegroundBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                            <ikw:SimpleStackPanel
                                Grid.Row="1"
                                Margin="6,2"
                                Orientation="Horizontal"
                                Spacing="4">
                                <ikw:SimpleStackPanel.Style>
                                    <Style TargetType="ikw:SimpleStackPanel">
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Plugin.TransResult.IsSuccess}" Value="False" />
                                                </MultiDataTrigger.Conditions>
                                                <MultiDataTrigger.Setters>
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </MultiDataTrigger.Setters>
                                            </MultiDataTrigger>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Plugin.TransResult.Text}" Value="" />
                                                </MultiDataTrigger.Conditions>
                                                <MultiDataTrigger.Setters>
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </MultiDataTrigger.Setters>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ikw:SimpleStackPanel.Style>
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=PlayAudioCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.Speaker2_20_Regular}"
                                    ToolTip="{DynamicResource Tts}" />
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CopyCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.Copy_20_Regular}"
                                    ToolTip="{DynamicResource Copy}" />
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CopyPascalCaseCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.TextCaseTitle_20_Regular}"
                                    ToolTip="{DynamicResource CopyAsPascalCase}"
                                    Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowPascalCase, Converter={cnvt:BoolToVisibilityConverter}}" />
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CopyCamelCaseCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.TextChangeCase_20_Regular}"
                                    ToolTip="{DynamicResource CopyAsCamelCase}"
                                    Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowCamelCase, Converter={cnvt:BoolToVisibilityConverter}}" />
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CopySnakeCaseCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.TextCaseLowercase_20_Regular}"
                                    ToolTip="{DynamicResource CopyAsSnakeCase}"
                                    Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowSnakeCase, Converter={cnvt:BoolToVisibilityConverter}}" />
                                <control:IconButton
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=InsertCommand}"
                                    CommandParameter="{Binding Plugin.TransResult.Text}"
                                    Icon="{x:Static ui:FluentSystemIcons.TextHanging_20_Regular}"
                                    ToolTip="{DynamicResource InsertText}"
                                    Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowInsert, Converter={cnvt:BoolToVisibilityConverter}}" />
                                <StackPanel Orientation="Horizontal" Visibility="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=ShowBackTranslation, Converter={cnvt:BoolToVisibilityConverter}}">
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=TransBackCommand}"
                                        CommandParameter="{Binding}"
                                        Icon="{x:Static ui:FluentSystemIcons.Flash_20_Regular}"
                                        ToolTip="{DynamicResource BackTranslation}"
                                        Visibility="{Binding Options.AutoBackTranslation, Converter={cnvt:BoolToVisibilityInverseConverter}}" />
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=TransBackCommand}"
                                        CommandParameter="{Binding}"
                                        Icon="{x:Static ui:FluentSystemIcons.FlashAuto_20_Regular}"
                                        ToolTip="{DynamicResource BackTranslation}"
                                        Visibility="{Binding Options.AutoBackTranslation, Converter={cnvt:BoolToVisibilityConverter}}" />
                                </StackPanel>
                            </ikw:SimpleStackPanel>
                        </Grid>
                        <ikw:SimpleStackPanel
                            x:Name="PART_TransBackPanel"
                            xf:Animations.Primary="{xf:Animate BasedOn={StaticResource ScaleVertically},
                                                               Event=Visibility,
                                                               Duration=300,
                                                               TransformOn=Layout}"
                            Spacing="3"
                            Visibility="{Binding Plugin.TransBackResult.Text, Converter={cnvt:EqualToVisibilityInverseConverter}}">
                            <Separator Background="{StaticResource {x:Static ui:ThemeKeys.ContentDialogSeparatorBorderBrushKey}}" />
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <TextBox
                                    Background="Transparent"
                                    BorderBrush="{x:Null}"
                                    BorderThickness="0"
                                    IsReadOnly="True"
                                    Text="{Binding Plugin.TransBackResult.Text}"
                                    TextWrapping="Wrap">
                                    <TextBox.Style>
                                        <Style BasedOn="{StaticResource {x:Type TextBox}}" TargetType="TextBox">
                                            <Setter Property="Foreground" Value="{DynamicResource TextControlForeground}" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Plugin.TransBackResult.IsSuccess}" Value="False">
                                                    <Setter Property="Foreground" Value="{DynamicResource SystemControlErrorTextForegroundBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <ikw:SimpleStackPanel
                                    Grid.Row="1"
                                    Margin="6,2"
                                    Orientation="Horizontal"
                                    Spacing="4">
                                    <ikw:SimpleStackPanel.Style>
                                        <Style TargetType="ikw:SimpleStackPanel">
                                            <Style.Triggers>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding Plugin.TransBackResult.IsSuccess}" Value="False" />
                                                    </MultiDataTrigger.Conditions>
                                                    <MultiDataTrigger.Setters>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </MultiDataTrigger.Setters>
                                                </MultiDataTrigger>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding Plugin.TransBackResult.Text}" Value="" />
                                                    </MultiDataTrigger.Conditions>
                                                    <MultiDataTrigger.Setters>
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </MultiDataTrigger.Setters>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ikw:SimpleStackPanel.Style>
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=PlayAudioCommand}"
                                        CommandParameter="{Binding Plugin.TransBackResult.Text}"
                                        Icon="{x:Static ui:FluentSystemIcons.Speaker2_20_Regular}" />
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CopyCommand}"
                                        CommandParameter="{Binding Plugin.TransBackResult.Text}"
                                        Icon="{x:Static ui:FluentSystemIcons.Copy_20_Regular}" />
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=InsertCommand}"
                                        CommandParameter="{Binding Plugin.TransBackResult.Text}"
                                        Icon="{x:Static ui:FluentSystemIcons.TextHanging_20_Regular}" />
                                    <control:IconButton
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=control:OutputControl}, Path=CleanTransBackCommand}"
                                        CommandParameter="{Binding Plugin}"
                                        Icon="{x:Static ui:FluentSystemIcons.DeleteLines_20_Regular}" />
                                </ikw:SimpleStackPanel>
                            </Grid>
                        </ikw:SimpleStackPanel>
                    </ikw:SimpleStackPanel>
                </Border>
            </Expander.Content>
        </Expander>
    </DataTemplate>

    <control:OutputPluginSelector
        x:Key="OutputPluginSelector"
        DictionaryTemplate="{StaticResource DictionaryPluginTemplate}"
        TranslateTemplate="{StaticResource TransaltePluginTemplate}" />

    <!--#endregion-->

    <Style TargetType="{x:Type control:OutputControl}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type control:OutputControl}">
                    <ItemsPresenter />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplateSelector" Value="{StaticResource OutputPluginSelector}" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>