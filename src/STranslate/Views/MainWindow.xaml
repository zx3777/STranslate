<Window
    x:Class="STranslate.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cnvt="clr-namespace:STranslate.Converters"
    xmlns:control="clr-namespace:STranslate.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:s="https://github.com/zggsong/2022/xaml"
    xmlns:tb="http://www.hardcodet.net/taskbar"
    xmlns:tray="http://schemas.lepo.co/wpfui/2022/xaml/tray"
    xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
    xmlns:vm="clr-namespace:STranslate.ViewModels"
    Name="STWindow"
    Title="STranslate"
    Width="{Binding Settings.MainWindowWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    MinWidth="400"
    MinHeight="200"
    MaxHeight="{Binding Settings.MainWindowMaxHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    control:SizeToContentBehavior.PersistentSizeToContent="Height"
    control:SnackbarBehavior.EnableSnackbar="True"
    d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel}"
    d:DesignHeight="800"
    d:DesignWidth="470"
    ui:TitleBar.CloseButtonAvailability="Collapsed"
    ui:TitleBar.ExtendViewIntoTitleBar="True"
    ui:TitleBar.MaximizeButtonAvailability="Collapsed"
    ui:TitleBar.MinimizeButtonAvailability="Collapsed"
    ui:WindowHelper.SystemBackdropType="Mica"
    ui:WindowHelper.UseModernWindowStyle="True"
    Icon="/Resources/app.ico"
    Left="{Binding Settings.MainWindowLeft, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    Loaded="OnLoaded"
    ShowInTaskbar="False"
    Top="{Binding Settings.MainWindowTop, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    Topmost="{Binding IsTopmost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    Visibility="Visible"
    WindowStartupLocation="Manual"
    mc:Ignorable="d">
    <Window.InputBindings>
        <KeyBinding
            Key="Esc"
            Command="{Binding CancelCommand}"
            CommandParameter="{Binding ElementName=STWindow}" />
        <KeyBinding
            Key="Q"
            Command="{Binding ExitCommand}"
            Modifiers="Ctrl+Shift" />
        <KeyBinding
            Key="{Binding HotkeySettings.OpenSettingsHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding OpenSettingsCommand}"
            Modifiers="{Binding HotkeySettings.OpenSettingsHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
        <KeyBinding
            Key="{Binding HotkeySettings.ToggleColorThemeHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding ChangeColorSchemeCommand}"
            Modifiers="{Binding HotkeySettings.ToggleColorThemeHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
        <KeyBinding
            Key="{Binding HotkeySettings.ToggleTopmostHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding ToggleTopmostCommand}"
            Modifiers="{Binding HotkeySettings.ToggleTopmostHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
        <KeyBinding
            Key="{Binding HotkeySettings.HideInputHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding ToggleHideInputCommand}"
            Modifiers="{Binding HotkeySettings.HideInputHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
        <KeyBinding
            Key="{Binding HotkeySettings.SaveToVocabularyHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding SaveToVocabularyCommand}"
            CommandParameter="{Binding InputText}"
            Modifiers="{Binding HotkeySettings.SaveToVocabularyHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
        <KeyBinding
            Key="{Binding HotkeySettings.OpenHistoryHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Key}}"
            Command="{Binding OpenHistoryCommand}"
            CommandParameter="{Binding InputText}"
            Modifiers="{Binding HotkeySettings.OpenHistoryHotkey.Key, Converter={cnvt:StringToKeyBindingConverter}, ConverterParameter={x:Static cnvt:HotkeyMode.Modifiers}}" />
    </Window.InputBindings>
    <Grid>
        <control:HeaderControl
            Padding="6,4,6,0"
            VerticalAlignment="Top"
            ColorSchemeCommand="{Binding ChangeColorSchemeCommand}"
            HistoryNextCommand="{Binding HistoryNextCommand}"
            HistoryPreviousCommand="{Binding HistoryPreviousCommand}"
            IsColorSchemeVisible="{Binding Settings.IsColorSchemeVisible}"
            IsHideInput="{Binding Settings.HideInput}"
            IsHideInputVisible="{Binding Settings.IsHideInputVisible}"
            IsMouseHook="{Binding IsMouseHook}"
            IsMouseHookVisible="{Binding Settings.IsMouseHookVisible}"
            IsScreenshotTranslateInImageVisible="{Binding Settings.IsScreenshotTranslateInImageVisible}"
            IsTopmost="{Binding IsTopmost}"
            ScreenshotTranslateInImage="{Binding Settings.ScreenshotTranslateInImage}"
            SettingCommand="{Binding OpenSettingsCommand}" />

        <ui:ScrollViewerEx Margin="10,37,10,5">
            <StackPanel>
                <!--  //  InputControl  //  -->
                <control:InputControl
                    x:Name="PART_Input"
                    Margin="0,0,0,10"
                    CopyCommand="{Binding CopyCommand}"
                    CurrentFontSize="{Binding Settings.FontSize}"
                    ExecuteCommand="{Binding TranslateCommand}"
                    ForceExecuteCommand="{Binding TranslateCommand}"
                    HasActivedVocabulary="{Binding VocabularyInstance.HasActivedVocabulary}"
                    IdentifiedLanguage="{Binding IdentifiedLanguage}"
                    IsIdentify="{Binding IsIdentifyProcessing}"
                    PlayAudioCommand="{Binding PlayAudioCommand}"
                    RemoveLineBreaksCommand="{Binding RemoveLineBreaksCommand}"
                    RemoveSpacesCommand="{Binding RemoveSpacesCommand}"
                    SaveToVocabularyCommand="{Binding SaveToVocabularyCommand}"
                    Text="{Binding InputText, UpdateSourceTrigger=PropertyChanged}"
                    TranslateOnPaste="{Binding Settings.TranslateOnPaste}"
                    Visibility="{Binding Settings.HideInput, Converter={cnvt:BoolToVisibilityInverseConverter}}" />

                <!--  // LangSelectControl //  -->
                <Grid Margin="0,0,0,10">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Settings.HideInput}" Value="True" />
                                        <Condition Binding="{Binding Settings.HideInputWithLangSelectControl}" Value="True" />
                                    </MultiDataTrigger.Conditions>
                                    <MultiDataTrigger.Setters>
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </MultiDataTrigger.Setters>
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <ComboBox
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        DisplayMemberPath="Display"
                        ItemsSource="{Binding DataProvider.LangEnums}"
                        SelectedValue="{Binding Settings.SourceLang}"
                        SelectedValuePath="Value" />

                    <Button
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Stretch"
                        Command="{Binding SwapLanguageCommand}">
                        <ui:FontIcon FontSize="{DynamicResource STControlFontSize16}" Icon="{x:Static ui:FluentSystemIcons.ArrowSwap_20_Regular}" />
                    </Button>

                    <ComboBox
                        Grid.Column="2"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        DisplayMemberPath="Display"
                        ItemsSource="{Binding DataProvider.LangEnums}"
                        SelectedValue="{Binding Settings.TargetLang}"
                        SelectedValuePath="Value" />
                </Grid>

                <!--  // OutputControl //  -->
                <control:OutputControl
                    CleanTransBackCommand="{Binding CleanTransBackCommand}"
                    CopyCommand="{Binding CopyCommand}"
                    ExplainCommand="{Binding ExplainCommand}"
                    InsertCommand="{Binding InsertCommand}"
                    ItemsSource="{Binding TranslateInstance.Services}"
                    NavigateCommand="{Binding NavigateCommand}"
                    PlayAudioCommand="{Binding PlayAudioCommand}"
                    PlayAudioUrlCommand="{Binding PlayAudioUrlCommand}"
                    RetryCommand="{Binding SingleTranslateCommand}"
                    ShowPrompt="{Binding Settings.ShowPromptButton}"
                    TransBackCommand="{Binding SingleTransBackCommand}" />
            </StackPanel>
        </ui:ScrollViewerEx>

        <!--#region Tray Icon-->

        <tb:TaskbarIcon
            x:Name="PART_NotifyIcon"
            IconSource="{Binding TrayIcon}"
            LeftClickCommand="{Binding ToggleAppCommand}"
            NoLeftClickDelay="True"
            ToolTipText="{Binding TrayToolTip}">
            <tb:TaskbarIcon.Resources>
                <s:BindingProxy x:Key="ViewModel" Data="{Binding}" />
            </tb:TaskbarIcon.Resources>
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu Style="{DynamicResource DefaultContextMenuStyle}">
                    <MenuItem Command="{Binding Source={StaticResource ViewModel}, Path=Data.ToggleAppCommand}">
                        <MenuItem.Header>
                            <Grid>
                                <TextBlock Text="{DynamicResource Open}" Visibility="{Binding Settings.DisableGlobalHotkeys, Converter={cnvt:BoolToVisibilityConverter}}" />
                                <TextBlock Visibility="{Binding Settings.DisableGlobalHotkeys, Converter={cnvt:BoolToVisibilityInverseConverter}}">
                                    <Run Text="{DynamicResource Open}" />
                                    <Run Text="(" />
                                    <Run Text="{Binding Source={StaticResource ViewModel}, Path=Data.HotkeySettings.OpenWindowHotkey.Key}" />
                                    <Run Text=")" />
                                </TextBlock>
                            </Grid>
                        </MenuItem.Header>
                        <MenuItem.Icon>
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.WindowAd_20_Regular}" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Command="{Binding Source={StaticResource ViewModel}, Path=Data.ResetLocationCommand}" Header="{DynamicResource ResetLocation}">
                        <MenuItem.Icon>
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.ArrowMinimize_20_Regular}" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem
                        Command="{Binding Source={StaticResource ViewModel}, Path=Data.OpenSettingsCommand}"
                        CommandParameter=""
                        Header="{DynamicResource Settings}">
                        <MenuItem.Icon>
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.Settings_20_Regular}" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Command="{Binding Source={StaticResource ViewModel}, Path=Data.ExitCommand}" Header="{DynamicResource Exit}">
                        <MenuItem.Icon>
                            <ui:FontIcon Icon="{x:Static ui:FluentSystemIcons.ArrowExit_20_Regular}" />
                        </MenuItem.Icon>
                    </MenuItem>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>

        <!--#endregion-->
    </Grid>
</Window>